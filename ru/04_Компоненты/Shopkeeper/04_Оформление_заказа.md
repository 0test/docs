В данный момент форма заказа делается при помощи сниппета eForm. Возможно также сделать всё на основе FormLister, используя prepare-конструкции.

* <a href="#eform">Оформление заказа на eForm</a>
* <a href="#formlister">Оформление заказа на FormLister</a>


<h1 id="eform">Оформление заказа на eForm</h1>

Важно: на странице формирования заказа сниппет Shopkeeper должен вызываться раньше eForm!

В чанке формы заказа обязательно добавить скрытое поле:
```
<input type="hidden" name="reportTpl" value="shopOrderReport">
```
где shopOrderReport - это название чанка с шаблоном отчета (параметр &report сниппета eForm).

```
&eFormOnBeforeMailSent=`populateOrderData` - функция для заполнения данных о выбранных товарах.
```

Для того чтобы заказы отправлялись в модуль Shopkeeper, в вызов сниппета eForm добавить параметр
```
&eFormOnMailSent=`sendOrderToManager`
```

### Пример вызова eForm: ###
```
[!eForm?
&formid=`shopOrderForm`
&tpl=`shopOrderForm`
&report=`shopOrderReport`
&ccsender=`1`
&gotoid=`11`
&subject=`Новый заказ`
&eFormOnBeforeMailSent=`populateOrderData`
&eFormOnMailSent=`sendOrderToManager`
!]
```

## Товары в каталоге Shopkeeper ##
Можно сохранять товары в отдельльную таблицу БД (не документы).При этом остается возможность использовать стандартные TV-параметры для товаров и плагины. Для создания и редактирования товаров используется стандартный интерфейс (можно настраивать с помощью плагина ManagerManager). Для вывода товаров на сайте используется сниппет catalogView.

Товары можно "вложить" в любой документ (категорию), выбрав в дереве документов. Т.е. категории каталога (структура) создается как и раньше, документами, но сами товары будут храниться в отдельной таблице БД.

Если товар из каталога Shopkeeeper, в чанк товара (сниппет catalogView) нужно вставить скрытое поле: 
```
<input type="hidden" name="shk-catalog" value="1" />
```
Чтобы в модуле Shopkeeper (в админке) появилась ссылка "Каталог", нужно в конфигурации указать ID категории каталога (документ MODx) по умолчанию.
Также необходимо настроить конфигурацию плагина SaveToSHK — указать ID шаблона товаров и ID TV-параметра цены.


## Важно! ## 

Рекомендуется использовать ЧПУ. В шаблонах сайта рекомендуется использовать `<base href="[(site_url)]">` внутри <head> и относительные пути.
Если чанки хранятся в файлах (используется команда @FILE:), проверьте кодировку этих файлов. Она должна быть такая же, как у вашего сайта.
  
Рекомендуется установить плагин PHx. В чанке chunk_shopOrderFormWebUser.tpl  он используется для заполнения скрытых полей данными авторизованного пользователя.
  
Для вывода корзины (сниппета) в разных местах рекомендуется создавать разные шаблоны для страниц или использовать плагин PHx.
Если используется умножение цены товара на цену доп.параметра, в шаблоне информации о товаре (chunk_shopStuff.tpl и chunk_shopToCart.tpl) поле с ID товара (`<input name="shk-id" value="[*id*]">`) должно быть выше доп. параметров по HTML-коду.


<h1 id="formlister">Оформление заказа на FormLister</h1>

Оформление заказа на основе FormLister находится в бета-тестировании.

Обсуждение доступно на сайте [сообщества](http://modx.im/blog/questions/4888.html).

В вызов FormLister добавить параметр &prepareProcess с кодом:
```
<?php
if(function_exists('populateOrderData')){
        $fields=array();
        populateOrderData($fields);
        $FormLister->setFields($fields);
}
if(function_exists('sendOrderToManager')){
        sendOrderToManager($data);
}
```

Как и в случае с eForm, вызов FormLister в коде страницы должен быть ниже, чем вызов Shopkeeeper!