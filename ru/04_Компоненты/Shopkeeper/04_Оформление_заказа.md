## Оформление заказа ##

Форма заказа делается при помощи сниппета eForm. При вызове этого сниппета обзательно указать параметры:

На странице формирования заказа сниппет Shopkeeper должен вызываться раньше eForm.
В чанке формы заказа обязательно добавить скрытое поле
```
<input type="hidden" name="reportTpl" value="shopOrderReport" />
```
где shopOrderReport - это название чанка с шаблоном отчета (параметр &report сниппета eForm).


```
&eFormOnBeforeMailSent=`populateOrderData` - функция для заполнения данных о выбранных товарах.
```
Для того чтобы заказы отправлялись в модуль Shopkeeper, в вызов сниппета eForm добавить параметр ```
&eFormOnMailSent=`sendOrderToManager`
```

Пример вызова eForm:
```
[!eForm? &formid=`shopOrderForm`&tpl=`shopOrderForm`&report=`shopOrderReport`&vericode=`1`&ccsender=`1`&gotoid=`11`&subject=`Новый заказ`&eFormOnBeforeMailSent=`populateOrderData`&eFormOnMailSent=`sendOrderToManager`!]
```







Товары в каталоге Shopkeeper
Можно сохранять товары в отдельльную таблицу БД (не документы). При хранении товаров в отдельной таблице можно забыть про ограничение на число документов MODx. При этом остается возможность использовать стандартные TV-параметры для товаров и плагины. Для создания и редактирования товаров используется стандартный интерфейс (можно настраивать с помощью плагина ManagerManager). Для вывода товаров на сайте используется сниппет catalogView (см. snippets/catalogView/readme.txt).

Товары можно "вложить" в любой документ (категорию), выбрав в дереве документов. Т.е. категории каталога (структура) создается как и раньше документами MODx, но сами товары будут храниться в отдельной таблице БД.

Если товар из каталога Shopkeeeper, в чанк товара (сниппет catalogView) нужно вставить скрытое поле: 

<input type="hidden" name="shk-catalog" value="1" />

Чтобы в модуле Shopkeeper (в админке) появилась ссылка "Каталог", нужно в конфигурации указать ID категории каталога (документ MODx) по умолчанию.
Также необходимо настроить конфигурацию плагина SaveToSHK — указать ID шаблона товаров и ID TV-параметра цены.


Важно!

Рекомендуется использовать ЧПУ (семантические URL). В шаблонах сайта рекомендуется использовать <base href="[(site_url)]" /> (внутри <head>) и относительные пути.
Если чанки хранятся в файлах (используется команда @FILE:), проверьте кодировку этих файлов. Она должна быть такая же как у вашего сайта.
Рекомендуется установить плагин PHx (http://modxcms.com/extras/package/?package=342).
В чанке chunk_shopOrderFormWebUser.tpl для примера он используется для заполнения скрытых полей данными авторизованного пользователя.
Для вывода корзины (сниппета) в разных местах рекомендуется создавать разные шаблоны для страниц или использовать плагин PHx.
Если используется умножение цены товара на цену доп.параметра, в шаблоне информации о товаре (chunk_shopStuff.tpl и chunk_shopToCart.tpl) поле с ID товара (<input type="hidden" name="shk-id" value="[*id*]" />) должно быть выше допюпараметров по HTML-коду.
Рекомендуется имена TV-параметров и чанков писать на латинице.
Рекомендованная кодировка - UTF-8.
Для работы необходим PHP версии не позднее 5.0. На PHP 5.3 пока не тестировалось.

Предупреждение
Т.к. сниппет производит действия с базой данных (запись, чтение), это может быть опасно. Автор попытался защититься от наиболее распространенных методов взлома системы, но всё может быть... Вы используете этот код на свой страх и риск. Автор не несет ответственности за последствия.
