
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<h2>FormLister: Регистрация пользователей</h2>

<p>Контроллер <span class="text-bold">Register</span> позволяет регистрировать пользователей в заданные группы и отправлять уведомления о регистрации. Контроллер является расширением контроллера Form, соответственно можно использовать соответствующие параметры для отправки писем при регистрации.</p>
<p>Имена полей в форме должны соответствовать полям модели <a href="doclister/modxapi.html">modUsers</a>.</p>
<p>Если в форме не задано поле username, то ему присваивается значение поля email. Таким образом можно регистрировать пользователей только по email.</p>
<p>Если в форме не задано поле password, то значение поля генерируется автоматически. То есть регистрацию пользователя можно свести к указанию email.</p>
<p>При регистрации с паролем, в форме может присутствовать поле repeatPassword. Если заданы правила валидации для полей password и repeatPassword, то при наличии для поля repeatPassword правила equals, оно будет автоматически скорректировано для проверки равенства значений полей password и repeatPassword:</p>
<pre class="brush: html;">"repeatPassword":{
	"required":"Введите пароль еще раз",
	"equals":{
		"params" : "Этот ключ в описании правила можно не задавать, он будет сформирован контроллером автоматически",
		"message":"Пароли не совпадают"
	}
}</pre>
<p>При регистрации следует проверять уникальность имени пользователя и email. В контроллере предусмотрены соответствующие правила:</p>
<pre class="brush: html;">&amp;rules=`{
	"username":{
		"required":"Введите имя пользователя",
		"alphaNumeric":"Только буквы и цифры",
		"custom":{
			"function":"\\FormLister\\Register::uniqueUsername",
			"message":"Имя уже занято"
		}
	},
	"email":{
		"required":"Введите email",
		"email":"Неверный email",
		"custom":{
			"function":"\\FormLister\\Register::uniqueEmail",
			"message":"Этот email уже использует другой пользователь"
		}
	}
}`</pre>
<p>В шаблонах доступны все поля модели для созданной записи. Дополнительно задается поле user.password с незашифрованным паролем. </p>
<h2 class="page-header">Параметры</h2>
<h3 class="sub-header text-bold">model</h3>
<p>Класс для работы с пользователями.</p>
<p>Возможные значения - имя класса.</p>
<p>Значение по умолчанию - \modUsers</p>
<h3 class="sub-header text-bold">modelPath</h3>
<p>Путь к файлу класса для работы с пользователями.</p>
<p>Возможные значения - относительный путь к файлу.</p>
<p>Значение по умолчанию - assets/lib/MODxAPI/modUsers.php</p>
<h3 class="sub-header text-bold">allowedFields</h3>
<p>Разрешенные для обработки поля. Поля, не указанные в списке, игнорируются. Поля username, email и password всегда разрешены.</p>
<p>Если не задано, то разрешены все поля.</p>
<p>Возможные значения - имена полей формы, разделенные запятой. </p>
<p>Значение по умолчанию - пусто.</p>
<h3 class="sub-header text-bold">forbiddenFields</h3>
<p>Запрещенные для обработки поля. Поля, указанные в списке, игнорируются. Поля username, email и password удаляются из списка запрещенных.</p>
<p>Возможные значения - имена полей формы, разделенные запятой. </p>
<p>Значение по умолчанию - пусто.</p>
<h3 class="sub-header text-bold">userGroups</h3>
<p>Добавляет зарегистрированного пользователя в указанные группы.</p>
<p>Возможные значения - имена групп, разделенные запятой (если имена содержат запятую в названии, то можно задать значение параметра массивом).</p>
<p>Значение по умолчанию - пусто.</p>
<h3 class="sub-header text-bold">checkActivation</h3>
<p>Включает проверку активации учетной записи пользователя (см. "Активация учетных записей"). При этом после сохранения записи будет установлено поле activate.url, содержащее ссылку на страницу с вызовом сниппета для активации учетной записи.  </p>
<p>Возможные значения - 1 или 0.</p>
<p>Значение по умолчанию - 0.</p>
<h3 class="sub-header text-bold">activateTo</h3>
<p>Если включена проверка активации, то в этом параметре необходимо указать id страницы, на которой вызывается сниппет для активации.</p>
<p>Возможные значения - id страницы.</p>
<p>Значение по умолчанию - значение $modx-&gt;config['site_start'].</p>
<h3 class="sub-header text-bold">preparePostProcess</h3>
<p>Позволяет выполнить обработку данных после сохранения.</p>
<p>Возможные значения - имена сниппетов, анонимные функции, статические методы загруженных классов.</p>
<p>Значение по умолчанию - пусто.</p>
<h3 class="sub-header text-bold">redirectTo</h3>
<p>Перенаправляет пользователя на указанную страницу после регистрации.</p>
<p>Возможные значения - id целевой страницы или массив.</p>
<p>Значение по умолчанию - пусто.</p>
<h3 class="sub-header text-bold">exitTo</h3>
<p>Перенаправляет уже авторизованного пользователя на указанную страницу.</p>
<p>Возможные значения - id целевой страницы.</p>
<p>Значение по умолчанию - пусто.</p>
<h3 class="sub-header text-bold">skipTpl</h3>
<p>Шаблон сообщения для уже авторизованного пользователя.</p>
<p>Возможные значения - имя шаблона, указанное по правилам задания шаблонов в DocLister.</p>
<p>Значение по умолчанию - запись из лексикона Register с ключом [+register.default_skipTpl+]</p>
<h3 class="sub-header text-bold">successTpl</h3>
<p>Шаблон сообщения об успешной регистрации. </p>
<p>Возможные значения - имя шаблона, указанное по правилам задания шаблонов в DocLister.</p>
<p>Значение по умолчанию - запись из лексикона Register с ключом [+register.default_successTpl+]</p>
<h3 class="sub-header text-bold">passwordLength</h3>
<p>Длина пароля (если создается автоматически).</p>
<p>Возможные значения - число символов больше 6.</p>
<p>Значение по умолчанию - 6.</p>