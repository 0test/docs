
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<h2>FormLister: Создание и редактирование документов пользователями</h2>

<p>Контроллер <span class="text-bold">Content</span> позволяет web-пользователям создавать и редактировать записи в таблицах MODxAPI. Расширяет контроллер Form, что позволяет отправлять письма после создания записи. При редактировании записей отправка почты отключена, при необходимости ее можно реализовать с помощью плагинов на событие сохранения (OnDocFormSave и т.п.).</p>
<p>Данные формы передаются в объект MODxAPI как есть, соответственно разработчику нужно заботиться об их корректности самостоятельно. </p>
<p>При редактировании записей можно запретить изменение отдельных полей, используя параметр keepDefaults.</p>
<p>При создании новой записи вызывается событие OnMakeDocUrl, в которое передается id записи и массив data со значениями полей записи. Это позволяет вернуть ссылку на созданную запись, она будет доступна через плейсхолдер [+content.url+]. Ссылку можно использовать в письме c уведомлением о создании новой записи.</p>
<p>Также можно использовать данные авторизованного пользователя, доступны через плейсхолдеры [+user.fullname+], [+user.email+] и т.д.</p>
<h2 class="page-header">Параметры</h2>
<h3 class="sub-header text-bold">model</h3>
<p>Класс MODxAPI.</p>
<p>Возможные значения - имя класса MODxAPI.</p>
<p>Значение по умолчанию - \modResource.</p>
<h3 class="sub-header text-bold">modelPath</h3>
<p>Путь к файлу класса, если класс не загружается заранее.</p>
<p>Возможные значения - относительный путь к файлу.</p>
<p>Значение по умолчанию - assets/lib/MODxAPI/modResource.php.</p>
<h3 class="sub-header text-bold">userModel</h3>
<p>Класс для работы с пользователями.</p>
<p>Возможные значения - имя класса.</p>
<p>Значение по умолчанию - \modUsers</p>
<h3 class="sub-header text-bold">userModelPath</h3>
<p>Путь к файлу класса для работы с пользователями.</p>
<p>Возможные значения - относительный путь к файлу.</p>
<p>Значение по умолчанию - assets/lib/MODxAPI/modUsers.php</p>
<h3 class="sub-header text-bold">onlyUsers</h3>
<p>Разрешить добавление записей только для зарегистрированных пользователей.</p>
<p>Возможные значения - 0, 1.</p>
<p>Значение по умолчанию - 1.</p>
<h3 class="sub-header text-bold">userGroups</h3>
<p>Группы пользователей, которым разрешено добавлять или изменять записи.</p>
<p>Возможные значения - список групп через точку с запятой.</p>
<p>Значение по умолчанию - пусто (разрешены любые группы).</p>
<h3 class="sub-header text-bold">onlyOwners</h3>
<p>Разрешает редактирование записей только их авторами. Автор определяется по полю, указанному в параметре ownerField.</p>
<p>Возможные значения - 0, 1.</p>
<p>Значение по умолчанию - 1.</p>
<h3 class="sub-header text-bold">ownerField</h3>
<p>Имя поля, определяющего владельца записи. Если работать с документами modResource, то это будет имя tv-параметра (в Evo не предусмотрено создание записей веб-пользователями).</p>
<p>Возможные значения - имя поля.</p>
<p>Значение по умолчанию - aid.</p>
<h3 class="sub-header text-bold">idField</h3>
<p>Имя ключа массива $_REQUEST, по которому определяется id редактируемой записи. Если ключ не задан, то контроллер вызывается в режиме создания записей. Информацию о режиме контроллера можно получить с помощью метода getMode.</p>
<p>В форме редактирования нужно предусмотреть скрытое поле с именем параметра, в котором будет сохраняться id записи.</p>
<p>Значение по умолчанию - id.</p>
<h3 class="sub-header text-bold">contentFields</h3>
<p>Задает сопоставление полей MODxAPI и полей формы. Можно не задавать, если имена полей совпадают. Если параметр не задан, то ограничить список передаваемых в модель полей можно с помощью параметров allowedFields и forbiddenFields.</p>
<p>Возможные значения - массив вида:</p>
<pre class="brush: html;">&amp;contentFields=`{
	"поле MODxAPI":"поле формы",
	"поле MODxAPI":"поле формы"
}
`</pre>
<p>Значение по умолчанию - пусто.</p>
<h3 class="sub-header text-bold">clearCache</h3>
<p>Очищать кэш после сохранения записи.</p>
<p>Возможные значения - 0, 1.</p>
<p>Значение по умолчанию - 0.</p>
<h3 class="sub-header text-bold">redirectTo</h3>
<p>Перенаправляет пользователя на указанную страницу после сохранения новой записи. В режиме редактирования не используется.</p>
<p>Возможные значения - id целевой страницы или массив.</p>
<p>Значение по умолчанию - пусто.</p>
<h3 class="sub-header text-bold">editAfterCreate</h3>
<p>Переправляет пользователя на страницу для редактирования созданной записи. Страница указывается в параметре redirectTo.</p>
<p>Возможные значения - 1 или 0.</p>
<p>Значение по умолчанию - 0.</p>
<h3 class="sub-header text-bold">editTpl</h3>
<p>Шаблон формы для редактирования документа.</p>
<p>Возможные значения - имя шаблона, указанное по правилам задания шаблонов в DocLister.</p>
<p>Значение по умолчанию - значение параметра formTpl.</p>
<h3 class="sub-header text-bold">badOwnerTpl</h3>
<p>Шаблон сообщения о том, что пользователь не является автором документа. Только режим редактирования.</p>
<p>Возможные значения - имя шаблона, указанное по правилам задания шаблонов в DocLister.</p>
<p>Значение по умолчанию - запись из лексикона Content с ключом [+edit.default_badOwnerTpl+].</p>
<h3 class="sub-header text-bold">badGroupTpl, badGroupEditTpl</h3>
<p>Шаблон сообщения о том, что пользователь не входит в группу пользователей которым разрешено создавать и редактировать документы.</p>
<p>Возможные значения - имя шаблона, указанное по правилам задания шаблонов в DocLister.</p>
<p>Значение по умолчанию - запись из лексикона Content с ключом<br>
[+create.default_badGroupTpl+] или [+edit.default_badGroupTpl+].</p>
<h3 class="sub-header text-bold">badRecordTpl</h3>
<p>Шаблон сообщения о том, что пользователь не может редактировать запись: например, запись не существует. Только режим редактирования.</p>
<p>Возможные значения - имя шаблона, указанное по правилам задания шаблонов в DocLister.</p>
<p>Значение по умолчанию - запись из лексикона Content с ключом [+edit.default_badRecordTpl+].</p>
<h3 class="sub-header text-bold">exitTo</h3>
<p>Перенаправляет неавторизованного пользователя на указанную страницу.</p>
<p>Возможные значения - id целевой страницы или массив.</p>
<p>Значение по умолчанию - пусто.</p>
<h3 class="sub-header text-bold">skipTpl, skipEditTpl</h3>
<p>Шаблон сообщения для неавторизованного пользователя. Для режима редактирования - skipEditTpl.</p>
<p>Возможные значения - имя шаблона, указанное по правилам задания шаблонов в DocLister.</p>
<p>Значение по умолчанию - запись из лексикона Content с ключом [+create.default_skipTpl+] (edit.default_skipEditTpl).</p>
<h3 class="sub-header text-bold">successTpl</h3>
<p>Шаблон сообщения об успешном сохранении новой записи.</p>
<p>Возможные значения - имя шаблона, указанное по правилам задания шаблонов в DocLister.</p>
<p>Значение по умолчанию - запись из лексикона Content с ключом [+create.default_successTpl+]</p>
<h3 class="sub-header text-bold">editSuccessTpl</h3>
<p>Шаблон сообщения об успешном обновлении записи. </p>
<p>Возможные значения - имя шаблона, указанное по правилам задания шаблонов в DocLister.</p>
<p>Значение по умолчанию - пусто.</p>