
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<h2>FormLister: Параметры</h2>

<h2 class="page-header">Общие параметры</h2>
<p>Эти параметры обрабатываются базовым классом FormLister. В контроллерах некоторые общие параметры могут иметь другое назначение.</p>
<h2 class="page-header">Настройки</h2>
<h3 class="sub-header text-bold">controller</h3>
<p>Задает класс для обработки данных. </p>
<p>Возможные значения - имя php-файла с классом без расширения.</p>
<p>Значение по умолчанию - Form.</p>
<h3 class="sub-header text-bold">dir</h3>
<p>Папка в которой находится класс контроллера.</p>
<p>Значение по умолчанию - assets/snippets/FormLister/core/controller/</p>
<h3 class="sub-header text-bold">formid</h3>
<p>Имя формы, обязательный параметр.</p>
<p>В шаблоне формы обязательно должно быть скрытое поле с именем formid и значением, указанным в параметре. Форма считается отправленной, если в массиве $_REQUEST присутствует ключ с именем параметра, а его значение соответствует значению параметра.</p>
<h3 class="sub-header text-bold">formMethod</h3>
<p>Возможные значения - post, get или request.</p>
<p>Значение по умолчанию - post.</p>
<h3 class="sub-header text-bold">config</h3>
<p>Загрузка параметров в формате json из файла.</p>
<p>Возможные значения - имяфайла:папка, несколько значений разделяются точкой с запятой.</p>
<h4>Пример</h4>
<p>myparams:core - загрузить параметры из файла assets/snippets/FormLister/config/core/myparams.json; myparams - загрузить параметры из файла assets/snippets/FormLister/config/custom/myparams.json; myparams:/assets/myfolder - загрузить параметры из файла assets/myfolder/myparams.json.</p>
<p>Значение по умолчанию - пусто.</p>
<h3 class="sub-header text-bold">api</h3>
<p>Определяет, в каком виде будут выводиться данные.</p>
<p>Возможные значения:</p>
<ul>
<li>0: только html;</li>
<li>1: json-массив с данными формы;</li>
<li>2: json-массив с данными формы и html.</li>
</ul>
<h3 class="sub-header text-bold">debug</h3>
<p>Режим отладки. Вывод записывается в лог MODX.</p>
<p>Возможные значения - 0, 1.</p>
<p>Значение по умолчанию - 0.</p>
<h3 class="sub-header text-bold">saveObject</h3>
<p>Сохраняет объект класса FormLister в плейсхолдер, который можно использовать в других сниппетах. Объект сохраняется только при успешной обработке формы.</p>
<p>Возможные значения - имя плейсхолдера.</p>
<p>Значение по умолчанию - пусто.</p>
<h3 class="sub-header text-bold">removeGpc</h3>
<p>Убирает экранирование данных, которое выполняет MODX для символов {{, [[ и т.д. При этом экранируются тэги MODX при выводе.</p>
<p>Возножные значения - 0, 1 или имена полей через запятую.</p>
<p>Значение по умолчанию - 0.</p>
<h2 class="page-header">Источники данных</h2>
<h3 class="sub-header text-bold">defaultsSources</h3>
<p>Позволяет загружать дополнительные данные из внешних источников, например, для предварительного заполнения полей формы. По умолчанию внешние данные загружаются только при начальном выводе формы и не загружаются после отправки формы Это поведение может быть изменено с помощью параметра keepDefaults.</p>
<p>Возможные значения: список источников, разделенных точкой с запятой. Загрузка данных производится в том порядке, в котором они указаны в списке.</p>
<p>Источник может задаваться в формате "имя:ключ:префикс". Префикс, если указан, добавляется c точкой к имени поля - например, config.site_name.</p>
<p>Возможные значения:</p>
<ul>
<li>array: json или php-массив, значения задаются параметром defaults;</li>
<li>param:имя параметра:префикс - значения задаются значением параметра из вызова сниппета (аналогично array, только значение задается не параметром defaults, а произвольным, также можно указать префикс);</li>
<li>session:ключ массива:префикс - значения загружаются из массива $_SESSION;</li>
<li>plh:ключи через запятую:префикс - загружаются значения из массива $modx-&gt;placeholders;</li>
<li>aplh:имя плейсхолдера:префикс - загружаются значения из плейсхолдера, содержащего массив;</li>
<li>config:префикс - загружаются значения из конфигурации MODX;</li>
<li>cookie:ключи через запятую:префикс - загружаются значения из массива $_COOKIE;</li>
<li>имя класса MODxAPI:ключ:префикс - ключ является аргументом метода edit(), класс должен быть заранее загружен;</li>
<li>document:префикс - загружает данные из модели modResource для документа, в котором вызван сниппет. Ключ не указывается;</li>
<li>user:ключ:префикс - загружает данные из модели modUsers для авторизованного пользователя. Тип пользователя уточняется в ключе (web или mgr).</li>
</ul>
<p>Значение по умолчанию - array.</p>
<h3 class="sub-header text-bold">defaults</h3>
<p>Данные для источника array.</p>
<p>Возможные значения: массив значений по умолчанию, в формате json или php.</p>
<h3 class="sub-header text-bold">keepDefaults</h3>
<p>Позволяет повторно загружать данные из внешних источников после отправки формы. Если в параметре указан список полей, то загружены будут только указанные поля.</p>
<p>Возможные значения: 1, 0, имена полей, разделенные запятой.</p>
<p>Значение по умолчанию - 0.</p>
<h3 class="sub-header text-bold">allowEmptyFields</h3>
<p>Разрешает задавать поля с пустыми значениями.</p>
<p>Возможные значения - 0 или 1.</p>
<p>Значение по умолчанию - 1.</p>
<h2 class="page-header">Элементы управления</h2>
<h3 class="sub-header text-bold">formControls</h3>
<p>Список полей с управляющими элементами формы (списки, чекбоксы, радио-кнопки). Необходимо для отслеживания состояния элементов.</p>
<p>Возможные значения - имена полей, разделенные запятой.</p>
<p>Значение по умолчанию - пусто.</p>
<h3 class="sub-header text-bold">emptyFormControls</h3>
<p>Этот параметр позволяет решить проблему неотмеченных чекбоксов, которые не включаются в массив полей при отправке формы: если в $_REQUEST отсутствует нужный элемент, то он создается согласно данному параметру. Необходимость в таком параметре возникла в связи с тем, что MODxAPI требует явно указывать изменяемые поля в методе fromArray(). Но можно использовать и в обычных формах, чтобы подставить в шаблон значение неотмеченного чекбокса. </p>
<p>Возможные значения - массив:</p>
<pre class="brush: html;">&amp;emptyFormControls=`{
    "mycheckbox" : "Нет",
    "published" : 0
}`</pre>
<h2 class="page-header">Обработка данных</h2>
<h3 class="sub-header text-bold">prepare, prepareProcess, prepareAfterProcess</h3>
<p>Аналогично параметру prepare в DocLister. </p>
<p>Сниппеты из параметра prepare выполняются после загрузки данных в форму, сниппеты из параметра prepareProcess - после прохождения валидации, сниппеты из параметра prepareAfterProcess - после успешного выполнения обработки. В сниппетах через переменную $FormLister доступен объект контроллера, а через массив $data - значения полей формы. Также доступна переменная $name, которая задержит имя параметра из которого взят сниппет (prepare, prepareProcess и т.д.); это позволяет использовать один и тот же сниппет для разных случаев. Для изменения данных следует использовать в prepare-сниппетах методы контроллера (setField, setFields и т.д.)</p>
<p>Возможные значения - имена сниппетов, анонимные функции, статические методы загруженных классов.</p>
<p>Значение по умолчанию - пусто.</p>
<h2 class="page-header">Валидация</h2>
<h3 class="sub-header text-bold">validator</h3>
<p>Имя класса для валидации данных. Класс должен быть предварительно загружен.</p>
<p>Значение по умолчанию - \FormLister\Validator.</p>
<h3 class="sub-header text-bold">rules</h3>
<p>Массив с правилами валидации.</p>
<p>Значение по умолчанию - пусто.</p>
<h2 class="page-header">Шаблоны</h2>
<h3 class="sub-header text-bold">formTpl</h3>
<p>Шаблон формы. В шаблоне формы обязательно должно быть поле с именем formid и значением, указанным в параметре formid.</p>
<p>Возможные значения - имя шаблона, указанное по правилам задания шаблонов в DocLister.</p>
<p>Значение по умолчанию - пусто.</p>
<h3 class="sub-header text-bold">arraySplitter</h3>
<p>Разделитель для преобразования массивов в строку. </p>
<p>Значение по умолчанию - точка с запятой.</p>
<h3 class="sub-header text-bold">{field}.arraySplitter</h3>
<p>Разделитель для преобразования массивов в строку, но для отдельного поля {field}. Например: groups.arraySplitter - разделитель для массива из поля groups.</p>
<p>Если не задано, то используется значение параметра arraySplitter.</p>
<h3 class="sub-header text-bold">errorTpl</h3>
<p>Шаблон для вывода сообщений валидатора.</p>
<p>Возможные значения - имя шаблона, указанное по правилам задания шаблонов в DocLister.</p>
<p>Значение по умолчанию:</p>
<pre class="brush: html;">@CODE:&lt;div class="error"&gt;[+message+]&lt;/div&gt;</pre>
<h3 class="sub-header text-bold">requiredClass, errorClass</h3>
<p>Имена классов для обозначения незаполненных (required) и неверно заполенных (error) полей.</p>
<p>Значение по умолчанию - required и error соответственно.</p>
<h3 class="sub-header text-bold">{field}.requiredClass, {field}.errorClass</h3>
<p>Позволяет задавать указанные выше классы для конкретных полей.</p>
<p>По умолчанию используются значения параметров requiredClass и errorClass.</p>
<h3 class="sub-header text-bold">messagesTpl</h3>
<p>Шаблон сообщений обработчика формы. В шаблоне выводятся группы сообщений (messages, required, error).</p>
<p>Возможные значения - имя шаблона, указанное по правилам задания шаблонов в DocLister.</p>
<p>Значение по умолчанию:</p>
<pre class="brush: html;">@CODE:&lt;div class="form-messages"&gt;[+messages+]&lt;/div&gt;</pre>
<h3 class="sub-header text-bold">messagesOuterTpl</h3>
<p>Шаблон-обертка для группы произвольных сообщений.</p>
<p>Возможные значения - имя шаблона, указанное по правилам задания шаблонов в DocLister.</p>
<p>Значение по умолчанию -</p>
<pre class="brush: html;">@CODE: [+messages+]</pre>
<h3 class="sub-header text-bold">messagesRequiredOuterTpl</h3>
<p>Шаблон-обертка для группы сообщений о незаполненных полях.</p>
<p>Возможные значения - имя шаблона, указанное по правилам задания шаблонов в DocLister.</p>
<p>Значение по умолчанию:</p>
<pre class="brush: html;">@CODE: [+messages+]</pre>
<h3 class="sub-header text-bold">messagesErrorOuterTpl</h3>
<p>Шаблон-обертка для группы сообщений о неверно заполненных полях.</p>
<p>Возможные значения - имя шаблона, указанное по правилам задания шаблонов в DocLister.</p>
<p>Значение по умолчанию:</p>
<pre class="brush: html;">@CODE: [+messages+]</pre>
<h3 class="sub-header text-bold">messagesSplitter, messagesRequiredSplitter, messagesErrorSplitter</h3>
<p>Разделитель сообщений в группе.</p>
<p>Возможные значения - произвольная строка.</p>
<p>Значение по умолчанию:</p>
<pre class="brush: html;">&lt;br&gt;</pre>
<h3 class="sub-header text-bold">removeEmptyPlaceholders</h3>
<p>Удаляет из шаблонов незаполненные прейслхолдеры.</p>
<p>Возможные значения - 0 или 1.</p>
<p>Значение по умолчанию - 0.</p>
<h3 class="sub-header text-bold">parseDocumentSource</h3>
<p>Обрабатывает чанки MODX-парсером.</p>
<p>Возможные значения - 0 или 1.</p>
<p>Значение по умолчанию - 0.</p>
<h3 class="sub-header text-bold">rewriteUrls</h3>
<p>Если параметр parseDocumentSource отключен, то парсит ссылки в шаблонах.</p>
<p>Возможные значения - 0 или 1.</p>
<p>Значение по умолчанию - 0.</p>
<h3 class="sub-header text-bold">skipPrerender</h3>
<p>Позволяет отключить предварительную обработку полей формы (экранирование значений, преобразование массивов в строки, установка сообщений об ошибках). Можно включить, если для вывода не используется парсер MODX. </p>
<p>Возможные значения - 0 или 1.</p>
<p>Значение по умолчанию - 0.</p>
<h3 class="sub-header text-bold">templatePath, templateExtension</h3>
<p>Путь к папке с файлами шаблонов и расширение файлов шаблонов. Эти параметры необходимо задавать при использовании плагина EvoTwig.</p>
<p>Значение по умолчанию - пусто.</p>
<h2 class="page-header">Перенаправление после обработки</h2>
<h3 class="sub-header text-bold">redirectTo</h3>
<p>Id страницы, на которую нужно выполнить перенаправление после успешной обработки формы. В api-режиме перенаправление не выполняется, но в массиве данных формы сохраняется абсолютная ссылка на целевую страницу (поле "redirectTo").</p>
<p>Вместо числа можно указывать массив:</p>
<pre class="brush: html;">&amp;redirectTo=`{
    "page":10,
    "query":{
        "foo":"bar"
    },
    "header":"HTTP/1.1 307 Temporary Redirect"
}`</pre>
<p>Ключ page задает id станицы, в массиве query можно передать дополнительные get-параметры, значением ключа header может быть текст заголовка для перенаправления.</p>
<p>Возможные значения - число или массив.</p>
<p>Значение по умолчанию - пусто.</p>